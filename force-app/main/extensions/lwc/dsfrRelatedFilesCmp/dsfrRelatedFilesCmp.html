<template>
    <!-- DATA LOAD UTILITY -->
    <c-sfpeg-list-cmp   object-api-name={objectApiName} 
                        record-id={recordId} user-id={currentUserId}
                        config-name={configName}
                        parent-context={listContext}
                        onload={handleRecordLoad}
                        is-debug={isDebug}
                        is-debug-fine={isDebug}
                        class="listLoader">
    </c-sfpeg-list-cmp>

    <!-- COMPONENT DISPLAY -->
    <div class={wrappingClass} >
        <lightning-layout multiple-rows="true" vertical-align="top" class="listHeader">
            <lightning-layout-item flexibility="auto" >
                <template lwc:if={label}>
                    <h3 class="fr-downloads-group__title fr-mb-2v">{label}</h3>
                </template>
            </lightning-layout-item>
            <template lwc:if={showRefresh} >
                <lightning-layout-item flexibility="auto, no-grow, no-shrink" alignment-bump="left" >
                    <c-dsfr-button-dsp  button-icon="refresh-line"              button-icon-position="noLabel"
                                        button-title="Raffraichir la liste"     button-variant="tertiary-no-outline"
                                        ontrigger={handleRefresh}               is-debug={isDebug}>
                    </c-dsfr-button-dsp>
                </lightning-layout-item>
            </template>
        </lightning-layout>
        <template lwc:if={isReady}>
            <ul>
                <template for:each={fileList} for:item="iterFile">
                    <li key={iterFile.linkId}>
                        <div class={iterFile.class}>
                            <!-- download -->
                            <p> 
                                <a  href="#"  class="fr-download__link"
                                    title={downloadTitle} name={iterFile.contentId}
                                    onclick={handleDownload}>
                                    {iterFile.title}
                                    <template lwc:if={iterFile.details}>
                                        <span class="fr-download__detail">
                                            <template for:each={iterFile.details} for:item="item">
                                                <span key={item.value} class="listItem">
                                                    <template lwc:if={item.prefix}>{item.prefix}&nbsp;</template>
                                                    {item.value}
                                                    <template lwc:if={item.suffix}>&nbsp;{item.suffix}</template>
                                                </span>
                                            </template>
                                        </span>
                                    </template>
                                </a>
                                <!--<lightning-formatted-number class="fr-download__detail" value={iterFile.ContentDocument.ContentSize} format-style="decimal" maximum-significant-digits="5"></lightning-formatted-number>-->
                                <template lwc:if={showDelete}>
                                    <button class="fr-btn fr-btn--sm fr-btn--tertiary-no-outline fr-icon-close-circle-line fr-py-0v"
                                            title={deleteTitle} name={iterFile.linkId} onclick={handleUnlink}>
                                    </button>
                                </template>
                            </p>
                        </div>                        
                    </li>
                </template>
            </ul>
            <lightning-spinner alternative-text="Opération en cours" size="small" variant="brand" class="slds-spinner_inline slds-hide">
            </lightning-spinner>
        </template>
    </div>
    <template lwc:if={isDebug}>
        <div class={wrappingCss}>
            <p class="fr-py-4v">
                <span class="fr-badge fr-badge--warning  fr-mr-4v">
                    Mode debug activé!
                </span>
                <span class="fr-badge fr-badge--info">
                    <a href="https://github.com/pegros/DSFR_LWR/blob/master/help/dsfrRelatedFilesCmp.md" target="_blank">
                        Voir la documentation</a>
                </span>
            </p>
        </div>
    </template>
</template>